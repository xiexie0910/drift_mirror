================================================================================
                              DRIFTMIRROR
                    Goal Tracking & Behavioral Reflection App
================================================================================

Project Overview
--------------------------------------------------------------------------------
DriftMirror is a minimal goal-tracking application with LLM-powered reflection
and plan adaptation. It focuses on what actually happened (not just intentions),
detects drift between plans and reality, and delivers evidence-backed insights
that quote the user's own words.

Philosophy: "Start before you think about the value. Value comes after you
start. Don't wait."

The system helps users track what actually happens, not what they hope will
happen. It identifies behavioral drift—the gap between intentions and
actions—and provides actionable insights for sustainable habit formation.


================================================================================
                              TECH STACK
================================================================================

FRONTEND
================================================================================
                              TECH STACK
================================================================================

FRONTEND
--------------------------------------------------------------------------------
Framework:        Next.js 14.1.0 (React 18.2.0)
Language:         TypeScript 5.3.3
Styling:          Tailwind CSS 3.4.1 with custom "Calm Futurism" design system
Animations:       Framer Motion 11.0.3 (spring physics, parallax, stagger effects)
Icons:            Lucide React 0.323.0
Build Tool:       Next.js built-in (Turbopack/Webpack)
UI Components:    Custom award-winning animations (MagneticButton, TiltCard, 
                  AnimatedCounter, ParallaxOrbs, TextReveal, RippleButton)

BACKEND
--------------------------------------------------------------------------------
Framework:        FastAPI (0.109.0+)
Language:         Python 3.10+
Database:         SQLite with SQLAlchemy 2.0+ ORM
Validation:       Pydantic 2.10.0+
HTTP Client:      HTTPX 0.26.0+ (general HTTP)
Text Processing:  PySpellChecker 0.8.0+
LLM SDK:          google-genai 1.0+

LLM INTEGRATION
--------------------------------------------------------------------------------
Provider:         Google Gemini (google-genai SDK)
Default Model:    gemini-2.0-flash
Behavior:         LLM is used for assessments, mirror reports, and summaries;
                  check-ins still save if LLM calls fail

DEVELOPMENT TOOLS
--------------------------------------------------------------------------------
Package Manager:  npm (frontend), pip (backend)
Type Checking:    TypeScript (frontend)
CSS Processing:   PostCSS, Autoprefixer
Environment:      dotenv for configuration


================================================================================
                           ARCHITECTURE
================================================================================

PROJECT STRUCTURE
--------------------------------------------------------------------------------
drift_mirror/
├── frontend/                    # Next.js frontend application
│   ├── app/                     # App Router pages
│   │   ├── page.tsx            # Landing page with demo seeding
│   │   ├── onboarding/         # Goal setup wizard
│   │   ├── dashboard/          # Goals overview & detail pages
│   │   │   └── [id]/          # Goal detail with metrics & timeline
│   │   ├── checkin/            # Daily check-in flow
│   │   ├── mirror/             # Insights & reflection reports
│   │   ├── globals.css         # Global styles & design tokens
│   │   └── layout.tsx          # Root layout
│   ├── components/              # Reusable UI components
│   │   ├── ui/                 # Base & animated components
│   │   │   ├── Button.tsx      # Button component with variants
│   │   │   ├── Card.tsx        # Card component
│   │   │   ├── Input.tsx       # Input component
│   │   │   ├── Slider.tsx      # Slider component
│   │   │   ├── MagneticButton.tsx  # Magnetic hover effect button
│   │   │   ├── AnimatedCounter.tsx # Spring-based number animations
│   │   │   ├── TiltCard.tsx    # 3D tilt card on hover
│   │   │   ├── TextReveal.tsx  # Word/character reveal animations
│   │   │   └── RippleButton.tsx# Click ripple effect button
│   │   ├── CelebrationProvider.tsx # Celebration effects
│   │   ├── InsightCard.tsx     # Mirror insights with actions
│   │   ├── MetricPills.tsx     # Animated metric displays
│   │   ├── MochiMascot.tsx     # Mascot / empty states
│   │   ├── ParallaxOrbs.tsx    # Interactive floating orbs
│   │   └── Timeline.tsx        # Visual check-in history
│   ├── lib/                     # Utilities & API client
│   │   ├── api.ts              # Backend API client with rate limiting
│   │   └── validation.ts       # Form validation utilities
│   ├── public/                  # Static assets
│   │   └── images/             # Image assets
│   └── tailwind.config.ts       # Tailwind + design system config
│
├── backend/                     # FastAPI backend application
│   ├── app/
│   │   ├── main.py             # FastAPI app entry point
│   │   ├── db.py               # Database configuration
│   │   ├── models.py           # SQLAlchemy ORM models
│   │   ├── schemas.py          # Pydantic request/response schemas
│   │   ├── routes/             # API route handlers
│   │   │   ├── resolutions.py  # Goal CRUD endpoints
│   │   │   ├── checkins.py     # Check-in endpoints
│   │   │   ├── dashboard.py    # Dashboard data aggregation
│   │   │   ├── demo.py         # Demo data seeding
│   │   │   └── reality_check.py# LLM-powered goal assessment
│   │   └── services/           # Business logic layer
│   │       ├── llm_client.py   # Gemini LLM integration
│   │       ├── drift.py        # Drift score computation
│   │       ├── reality_check.py# Step-based goal clarity assessment
│   │       ├── goal_assessment.py# Full questionnaire assessment
│   │       ├── onboarding_agents.py# Minimum actions + accountability
│   │       ├── progress_summary.py# AI progress summaries
│   │       └── prompts.py      # LLM prompt templates
│   ├── requirements.txt         # Python dependencies
│   └── driftmirror.db          # SQLite database file
│
├── .env                         # Environment configuration
├── .env.example                 # Example environment variables
└── README.md                    # Quick start guide


API ARCHITECTURE
--------------------------------------------------------------------------------
The backend follows a layered architecture:

1. ROUTES LAYER (app/routes/)
   - HTTP request handling
   - Input validation via Pydantic schemas
   - Response serialization

2. SERVICES LAYER (app/services/)
   - Business logic implementation
   - LLM integration and prompt handling
   - Drift calculation algorithms
   - Insight suggestion logic

3. DATA LAYER (app/models.py, app/db.py)
   - SQLAlchemy ORM models
   - Database session management
   - SQLite persistence


DATABASE SCHEMA
--------------------------------------------------------------------------------
RESOLUTIONS (Goals)
- id: Primary key
- title: Goal name (max 255 chars)
- why: Motivation/purpose
- mode: personal_growth | productivity
- frequency_per_week: Target sessions (default: 3)
- min_minutes: Minimum duration (default: 15)
- minimum_action_text: Smallest doable action
- created_at: Timestamp

PLANS (Versioned goal parameters)
- id: Primary key
- resolution_id: Foreign key to Resolution
- version: Incrementing version number
- frequency_per_week, min_minutes, time_window
- recovery_step: Sug: Target frequency
- min_minutes: Minimum duration
- created_at: Timestamp

CHECKINS (Daily progress logs)
- id: Primary key
- resolution_id: Foreign key
- planned: Minimum action text (computed)
- actual: What actually happened (computed)
- blocker: Obstacle description (optional)
- completed: Boolean success flag
- did_minimum_action: Did they do minimum?
- extra_done: Additional accomplishments/notes
- friction: Difficulty rating (1-3)
- created_at: Timestamp

SIGNALS (Derived patterns)
- id: Primary key
- checkin_id: Foreign key
- signal_type: completion | miss | friction | ease | extra | blocker
- content: Signal description
- severity: 0.0 to 1.0
- created_at: Timestamp

MIRROR_REPORTS (LLM-generated insights)
- id: Primary key
- resolution_id: Foreign key
- findings: JSON array of insights (finding, evidence, root_cause_hypothesis)
- counterfactual: "What if you had..." reflection
- drift_score: 0.0 to 1.0
- actionable_suggestions: JSON array of plan tweaks
- recurring_blockers: JSON array of frequent blockers
- strength_pattern: Text summary of what's working
- created_at: Timestamp

FEEDBACK (User reactions to reports)
- id: Primary key
- mirror_report_id: Foreign key
- helpful: Boolean
- created_at: Timestamp

INSIGHT_ACTIONS (User actions on suggestions)
- id: Primary key
- resolution_id: Foreign key
- mirror_report_id: Optional foreign key
- insight_summary: Short summary of the insight
- action_taken: accept | constrain | ignore
- constraint_details: Optional text
- suggested_changes: JSON payload of plan changesntries_count
- key_wins, patterns_observed, growth_areas, user_reflection
- created_at: Timestamp


================================================================================
                           CORE FEATURES
================================================================================

1. TWO-PHASE GOAL ONBOARDING
--------------------------------------------------------------------------------
Phase 1 captures goal, why, boundaries, and weekly frequency, then runs a full
questionnaire assessment (Agent A) with clarity signals, flags, and rewrite
options. Phase 2 (Agent B) generates minimum actions and accountability ideas
so the user can pick what fits.

2. MINIMUM ACTION + MOMENTUM SCALING
--------------------------------------------------------------------------------
Every goal has a minimum action. When minimum-action streaks are high and
friction is low, the system can suggest a "momentum minimum" to gently scale up.

3. DAILY CHECK-INS
--------------------------------------------------------------------------------
Check-ins capture:
1) whether the minimum action happened
2) optional extra progress
3) friction (easy/medium/hard)
4) blockers (if missed)

Check-ins are always saved; signals are derived deterministically for drift.

4. DRIFT DETECTION (WEEKLY-AWARE)
--------------------------------------------------------------------------------
Drift uses completion, friction, blocker patterns, and weekly frequency stats
(this-week count vs target). Drift > 0.4 with 3+ check-ins triggers a mirror
report.

5. MIRROR REPORTS WITH EVIDENCE
--------------------------------------------------------------------------------
Mirror reports quote the user’s own words and include:
- findings with evidence
- root-cause hypotheses
- recurring blockers
- a strength pattern (what’s working)
- a counterfactual reflection
- actionable suggestions (duration/frequency adjustments)

6. INSIGHT ACTIONS + PLAN VERSIONING
--------------------------------------------------------------------------------
Users can accept, constrain, or ignore suggestions. Accepting a suggestion
creates a new plan version; users can also revert to the original plan or update
the minimum action text.

7. PROGRESS SUMMARIES
--------------------------------------------------------------------------------
AI summaries synthesize "extra_done" notes into wins, growth observations, and
days-to-habit estimates.


================================================================================
                        DESIGN SYSTEM
================================================================================
- actionable suggestions (duration/frequency adjustments, not time-window)
PHILOSOPHY: "CALM FUTURISM"
--------------------------------------------------------------------------------
- Subtle depth, not spectacle
- Material-based surfaces (glass effects)
- Precision and restraint
- Teal as the sole accent color (used sparingly)

COLOR PALETTE
--------------------------------------------------------------------------------
Primary Accent: Teal
  - teal-50 through teal-900 (10 shades)
  - Used for icons, buttons, glows, accents

Neutral: Warm grays
  - neutral-50 through neutral-900
  - Used for text, backgrounds, borders

Semantic States:
  - Complete: Soft green (#6EE7B7)
  - Attention: Soft amber (#FCD34D)
  - Concern: Soft rose (#FDA4AF)
morphism effects)
- Precision and restraint
- Teal as the sole accent color (used sparingly)
- Interactive animations that feel premium, not AI-generated
- Spring physics for natural, organic motion
- Stagger effects for sequential reveals
- Parallax and 3D transforms for depth--------------------------------
.glass-subtle:   Light blur, minimal opacity
.glass-strong:   Medium blur, white overlay
.glass-quiet:    Subtle blur, transparent feel
.glass-card:     Card-optimized with shadows

All glass surfaces include subtle teal tint in shadows.

TYPOGRAPHY
--------------------------------------------------------------------------------
Font Stack: Inter, system fonts
Mono Font: SF Mono, Monaco, Cascadia Mono
 (Framer Motion)
--------------------------------------------------------------------------------
Core Animation Components:
- MagneticButton: Cursor-following magnetic hover effect with spring physics
- AnimatedCounter: Spring-based number counting with circular progress
- TiltCard: 3D perspective tilt following cursor position
- ParallaxOrbs: 5 interactive floating orbs with mouse-aware parallax
- TextReveal: Word-by-word and character-by-character entrance animations
- RippleButton: Click ripple effect emanating from click position

Animation Patterns:
- Spring physics (type: 'spring') for natural, organic motion
- Stagger effects for sequential reveals (staggerChildren)
- Motion variants for reusable animation presets
- AnimatePresence for smooth exit animations
- Hover/tap states with scale transforms

Page Animations:
- Landing page: ParallaxOrbs + CharacterReveal + TiltCard features
- Dashboard: Staggered card entrance with spring animations
- Goal detail: Animated modals, counters, and interactive buttons
- Check-in: Step-by-step AnimatePresence transitions
- Timeline: Connected path with animated nodes and hover effects------------------------------------
- fade-in: Subtle vertical entrance (0.2s)
- scale-in: Subtle scale entrance (0.2s)
- pulse-soft: Gentle pulsing for loading states
- Glass shine/sweep effects for premium feel

All animations are calm and predictable—no jarring effects.


================================================================================
                        API ENDPOINTS
================================================================================

RESOLUTIONS (Goals)
--------------------------------------------------------------------------------
GET    /api/resolutions              List all goals
POST   /api/resolutions              Create new goal
GET    /api/resolutions/{id}/        Get goal details
DELETE /api/resolutions/{id}/        Delete goal
GET    /api/resolutions/{id}/plans   List plan versions
GET    /api/resolutions/{id}/current-plan   Get current plan
POST   /api/resolutions/{id}/revert-plan    Revert to original plan
PATCH  /api/resolutions/{id}/minimum-action Update minimum action text
POST   /api/resolutions/{id}/insights/actions  Record insight action
GET    /api/resolutions/{id}/insights/actions  List insight actions
(5 checkins, mirror report)
                                     Returns resolution_id for frontend redirect
CHECKINS
--------------------------------------------------------------------------------
POST   /api/checkins                 Create new check-in
GET    /api/checkins/{resolution_id}/ Get check-ins for goal

DASHBOARD
--------------------------------------------------------------------------------
GET    /api/dashboard                Get latest goal dashboard
GET    /api/dashboard/{id}/          Get dashboard for specific goal
POST   /api/dashboard/feedback/      Submit mirror feedback
GET    /api/dashboard/{id}/summary/  AI progress summary

REALITY CHECK (LLM Assessment)
--------------------------------------------------------------------------------
POST   /api/reality-check/assess/         Assess full questionnaire (Agent A)
POST   /api/reality-check/generate-options/ Generate minimum actions + accountability (Agent B)
POST   /api/reality-check/               Legacy per-step assessment

DEMO
--------------------------------------------------------------------------------
POST   /api/demo/seed                Seed demo data for testing

HEALTH
--------------------------------------------------------------------------------
GET    /api/health                   Health check endpoint


================================================================================
                        LLM INTEGRATION
================================================================================

GEMINI CONFIGURATION
--------------------------------------------------------------------------------
Provider:    Google Gemini via google-genai SDK
API Key:     GEMINI_API_KEY (required)
Model:       GEMINI_MODEL (default: gemini-2.0-flash)

PROMPT SAFETY
--------------------------------------------------------------------------------
- Automatic prompt truncation to prevent context overflow
- Keeps first 60% and last 40% of content when truncating
- Maximum prompt characters: 6000 (configurable)

USE CASES
--------------------------------------------------------------------------------
1. Full questionnaire assessment (Agent A)
2. Minimum actions + accountability suggestions (Agent B)
3. Mirror report composition and progress summaries


================================================================================
                     SECURITY CONSIDERATIONS
================================================================================

BACKEND SECURITY
--------------------------------------------------------------------------------
- CORS middleware with configurable allowed origins
- TrustedHost middleware in production
- API docs disabled in production mode
- Security headers on all responses
- Input validation via Pydantic schemas
- Parameterized SQL queries (SQLAlchemy ORM)

FRONTEND SECURITY
--------------------------------------------------------------------------------
- Input sanitization for user text
- Character limits on all text inputs
- Security headers + CSP defined in Next.js config
- /api/* proxy to backend to avoid direct backend exposure

ENVIRONMENT VARIABLES
--------------------------------------------------------------------------------
Required in .env:
- GEMINI_API_KEY: Google Gemini API key
- GEMINI_MODEL: Gemini model name (default: gemini-2.0-flash)
- MAX_PROMPT_CHARS: Prompt character cap (default: 6000)
- ENVIRONMENT: development | production
- ALLOWED_ORIGINS: Comma-separated list of allowed origins
- ALLOWED_HOSTS: Comma-separated list of allowed hosts


================================================================================
                      GETTING STARTED
================================================================================

PREREQUISITES
----------------------------------1
Backend API:  http://localhost:8000
API Docs:     http://localhost:8000/docs (dev only)

DEMO MODE
--------------------------------------------------------------------------------
Click "See it in Action" button on the landing page to seed demo data:
- Creates demo goal "Learn Spanish for 15 minutes daily"
- Seeds 5 check-ins with realistic drift patterns
- Generates mirror report with 3 actionable suggestions
- Redirects to goal dashboard to explore the app

The demo works without GEMINI_API_KEY (data is pre-generated)
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cp ../.env.example ../.env
uvicorn app.main:app --reload --port 8000

FRONTEND SETUP
--------------------------------------------------------------------------------
cd frontend
npm install
npm run dev

ACCESS
--------------------------------------------------------------------------------
Frontend:     http://localhost:3000
Backend API:  http://localhost:8000
API Docs:     http://localhost:8000/docs (dev only)

DEMO MODE
--------------------------------------------------------------------------------
Click "Load Demo Data" on the dashboard to seed sample data
and trigger a mirror report instantly for testing.


================================================================================
                     DEVELOPMENT WORKFLOW
================================================================================

ADDING A NEW FEATURE
--------------------------------------------------------------------------------
1. Define Pydantic schemas (ba with shared animations)
- [ ] Push notifications for check-in reminders
- [ ] Weekly/monthly summary emails
- [ ] Integration with calendar apps
- [ ] Enhanced streak celebrations with confetti
- [ ] Community features (anonymous pattern sharing)
- [ ] More LLM models support (OpenAI, Anthropic)
- [ ] Data export/import functionality (JSON/CSV)
- [ ] Dark mode theme with same calm aesthetic
- [ ] Diary entries and quarterly reviews (schemas exist)
- [ ] Time window preferences (removed for now, could be re-added)
--------------------------------------------------------------------------------
- Use demo data seeding for quick testing
- Check API health: GET /api/health
- Frontend dev server has hot reload
- Backend has auto-reload via uvicorn --reload


================================================================================
                         FUTURE ROADMAP
================================================================================

POTENTIAL ENHANCEMENTS
--------------------------------------------------------------------------------
- [ ] User authentication and multi-user support
- [ ] Mobile app (React Native)
- [ ] Push notifications for check-in reminders
- [ ] Weekly/monthly summary emails
- [ ] Integration with calendar apps
- [ ] Habit streaks and milestone celebrations
- [ ] Community features (anonymous pattern sharing)
- [ ] More LLM models support (OpenAI, Anthropic)
- [ ] Data export/import functionality
- [ ] Dark mode theme


================================================================================
                          LICENSE
================================================================================

This is a personal project. All rights reserved.


================================================================================
                         CONTACT
================================================================================

For questions or contributions, please reach out to the project maintainer.


================================================================================
                    END OF PROJECT DESCRIPTION
================================================================================
